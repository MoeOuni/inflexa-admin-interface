import{d as O,e as S,J as K,K as B,M as F,N as Q,Z as U,g as l,$ as H,j as e,a0 as Z,a1 as M,a2 as G,a3 as J,a4 as X,a5 as Y,X as W,I as ee,B as g,C as se,a as ae,b as ne,H as te,c as re}from"./index-Cpj_313k.js";import{z as f,u as oe,t as ie,F as le,a as N,b as w,c as k,d as P,e as R,f as ce}from"./index-Bir7vsR2.js";import{T as de}from"./textarea-CmUeH0Hs.js";import{C as ue}from"./checkbox-CIFzVmYh.js";import{B as pe}from"./back-button-D-5gooSg.js";import{S as me}from"./square-plus-BaUgSyD7.js";import{T as he}from"./trash-2-BMyQxXfG.js";import"./index-DzltJMM4.js";const xe=async()=>(await S.get("/roles?expanded=true")).data;function ye(){return O({queryKey:y.all,queryFn:xe})}const fe=async s=>await S.patch(`/roles/${s._id}`,s);function je(){const s=K();return B({mutationFn:fe,onMutate:async()=>{await s.cancelQueries({queryKey:y.all})},onSuccess:()=>{F.success("Role updated successfully")},onError:n=>{var r,t;F.error(((t=(r=n==null?void 0:n.response)==null?void 0:r.data)==null?void 0:t.message)||"An error occurred. Please try again.")},onSettled:()=>{s.invalidateQueries({queryKey:y.all})}})}const y={all:["roles"],details:()=>[...y.all,"detail"],detail:s=>[...y.details(),s],pagination:s=>[...y.all,"pagination",s],infinite:()=>[...y.all,"infinite"]},ge=async s=>await S.post("/roles",s);function Ce(){const s=K();return B({mutationFn:ge,onSuccess:()=>{s.invalidateQueries({queryKey:y.all}),F.success("Role created successfully")},onError:n=>{var r,t;F.error(((t=(r=n==null?void 0:n.response)==null?void 0:r.data)==null?void 0:t.message)||"An error occurred. Please try again.")}})}const be=async()=>(await S.get("/permissions")).data;function ve(){return O({queryKey:j.all,queryFn:be})}const j={all:["permissions"],details:()=>[...j.all,"detail"],detail:s=>[...j.details(),s],pagination:s=>[...j.all,"pagination",s],infinite:()=>[...j.all,"infinite"]};/**
 * @license lucide-react v0.441.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ne=Q("ArrowUpDown",[["path",{d:"m21 16-4 4-4-4",key:"f6ql7i"}],["path",{d:"M17 20V4",key:"1ejh1v"}],["path",{d:"m3 8 4-4 4 4",key:"11wl7u"}],["path",{d:"M7 4v16",key:"1glfcx"}]]);/**
 * @license lucide-react v0.441.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const we=Q("Cog",[["path",{d:"M12 20a8 8 0 1 0 0-16 8 8 0 0 0 0 16Z",key:"sobvz5"}],["path",{d:"M12 14a2 2 0 1 0 0-4 2 2 0 0 0 0 4Z",key:"11i496"}],["path",{d:"M12 2v2",key:"tus03m"}],["path",{d:"M12 22v-2",key:"1osdcq"}],["path",{d:"m17 20.66-1-1.73",key:"eq3orb"}],["path",{d:"M11 10.27 7 3.34",key:"16pf9h"}],["path",{d:"m20.66 17-1.73-1",key:"sg0v6f"}],["path",{d:"m3.34 7 1.73 1",key:"1ulond"}],["path",{d:"M14 12h8",key:"4f43i9"}],["path",{d:"M2 12h2",key:"1t8f8n"}],["path",{d:"m20.66 7-1.73 1",key:"1ow05n"}],["path",{d:"m3.34 17 1.73-1",key:"nuk764"}],["path",{d:"m17 3.34-1 1.73",key:"2wel8s"}],["path",{d:"m11 13.73-4 6.93",key:"794ttg"}]]);var q="Collapsible",[ke,ze]=U(q),[Fe,E]=ke(q),$=l.forwardRef((s,n)=>{const{__scopeCollapsible:r,open:t,defaultOpen:o,disabled:c,onOpenChange:a,...h}=s,[u=!1,i]=H({prop:t,defaultProp:o,onChange:a});return e.jsx(Fe,{scope:r,disabled:c,contentId:Z(),open:u,onOpenToggle:l.useCallback(()=>i(p=>!p),[i]),children:e.jsx(M.div,{"data-state":D(u),"data-disabled":c?"":void 0,...h,ref:n})})});$.displayName=q;var z="CollapsibleTrigger",L=l.forwardRef((s,n)=>{const{__scopeCollapsible:r,...t}=s,o=E(z,r);return e.jsx(M.button,{type:"button","aria-controls":o.contentId,"aria-expanded":o.open||!1,"data-state":D(o.open),"data-disabled":o.disabled?"":void 0,disabled:o.disabled,...t,ref:n,onClick:G(s.onClick,o.onOpenToggle)})});L.displayName=z;var A="CollapsibleContent",V=l.forwardRef((s,n)=>{const{forceMount:r,...t}=s,o=E(A,s.__scopeCollapsible);return e.jsx(J,{present:r||o.open,children:({present:c})=>e.jsx(Se,{...t,ref:n,present:c})})});V.displayName=A;var Se=l.forwardRef((s,n)=>{const{__scopeCollapsible:r,present:t,children:o,...c}=s,a=E(A,r),[h,u]=l.useState(t),i=l.useRef(null),p=X(n,i),d=l.useRef(0),x=d.current,C=l.useRef(0),b=C.current,_=a.open||h,T=l.useRef(_),v=l.useRef();return l.useEffect(()=>{const m=requestAnimationFrame(()=>T.current=!1);return()=>cancelAnimationFrame(m)},[]),Y(()=>{const m=i.current;if(m){v.current=v.current||{transitionDuration:m.style.transitionDuration,animationName:m.style.animationName},m.style.transitionDuration="0s",m.style.animationName="none";const I=m.getBoundingClientRect();d.current=I.height,C.current=I.width,T.current||(m.style.transitionDuration=v.current.transitionDuration,m.style.animationName=v.current.animationName),u(t)}},[a.open,t]),e.jsx(M.div,{"data-state":D(a.open),"data-disabled":a.disabled?"":void 0,id:a.contentId,hidden:!_,...c,ref:p,style:{"--radix-collapsible-content-height":x?`${x}px`:void 0,"--radix-collapsible-content-width":b?`${b}px`:void 0,...s.style},children:_&&o})});function D(s){return s?"open":"closed"}var _e=$;const Pe=_e,Re=L,Me=V,qe=f.object({name:f.string().nonempty("Name is required."),description:f.string().nonempty("Description is required."),permissions:f.array(f.string()).refine(s=>s.some(n=>n),{message:"You have to select at least one permission."})}),Ee=({selectedRole:s})=>{var u;const n=ve(),r=je(),t=Ce(),[o,c]=W.useState({name:(s==null?void 0:s.name)||"",description:(s==null?void 0:s.description)||"",permissions:((u=s==null?void 0:s.permissions)==null?void 0:u.map(i=>(i==null?void 0:i._id)??i))||[]}),a=oe({resolver:ie(qe),defaultValues:o,mode:"onChange"});async function h(i){let p;s?(await r.mutateAsync({...i,_id:s._id}),p=r.status):(await t.mutateAsync(i),p=t.status),p==="success"&&(c(void 0),a.reset())}return e.jsx(le,{...a,children:e.jsxs("form",{onSubmit:a.handleSubmit(h),className:"space-y-4",children:[e.jsx(N,{control:a.control,name:"name",render:({field:i})=>e.jsxs(w,{children:[e.jsx(k,{children:"Name"}),e.jsx(P,{children:e.jsx(ee,{...i,placeholder:"Permission Name"})}),e.jsx(R,{})]})}),e.jsx(N,{control:a.control,name:"description",render:({field:i})=>e.jsxs(w,{children:[e.jsx(k,{children:"Description"}),e.jsx(P,{children:e.jsx(de,{...i,placeholder:"Description"})}),e.jsx(R,{})]})}),e.jsx(N,{control:a.control,name:"permissions",render:()=>{var i,p;return e.jsxs(w,{children:[e.jsx(k,{children:"Permissions"}),e.jsx(R,{}),e.jsx("div",{className:"flex flex-wrap",children:(p=(i=n.data)==null?void 0:i.permissions)==null?void 0:p.map(d=>e.jsx("div",{className:"w-full md:w-1/2 p-1",children:e.jsx(N,{control:a.control,name:"permissions",render:({field:x})=>e.jsxs(w,{className:"flex flex-row items-start space-x-3 space-y-0 bg-white/40 dark:bg-black/40  rounded-md border p-4 shadow",children:[e.jsx(P,{children:e.jsx(ue,{checked:x.value.includes(d._id),onCheckedChange:C=>C?x.onChange([...x.value,d._id]):x.onChange(x.value.filter(b=>b!==d._id))})}),e.jsxs("div",{className:"space-y-1 leading-none",children:[e.jsx(k,{children:d.name}),e.jsx(ce,{children:d==null?void 0:d.description})]})]},d._id)})},d._id))})]})}}),e.jsx("div",{className:"p-1",children:e.jsx(g,{type:"submit",children:"Submit"})})]})})},Ae=({role:s,setSelectedRole:n})=>{var o,c;const[r,t]=l.useState(!1);return e.jsxs(Pe,{open:r,onOpenChange:t,children:[e.jsxs("div",{className:"flex flex-col items-start lg:items-center md:items-center lg:flex-row md:flex-row justify-between  px-4",children:[e.jsxs("h4",{className:"text-sm font-semibold",children:["@",s.name," (",(o=s==null?void 0:s.permissions)==null?void 0:o.length," permissions)"]}),e.jsxs("div",{children:[e.jsxs(g,{variant:"ghost",size:"sm",children:[e.jsx(he,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"Delete"})]}),e.jsxs(g,{variant:"ghost",size:"sm",onClick:()=>n(s),children:[e.jsx(we,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"Edit"})]}),e.jsx(Re,{asChild:!0,children:e.jsxs(g,{variant:"ghost",size:"sm",children:[e.jsx(Ne,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"Toggle"})]})})]})]}),e.jsx("div",{className:"rounded-md border px-4 mb-2 py-2 font-mono text-sm shadow-sm",children:s.description}),e.jsx(Me,{className:"space-y-2",children:(c=s.permissions)==null?void 0:c.map(a=>e.jsxs("div",{className:"rounded-md border px-4 py-2 font-mono text-sm shadow-sm",children:["@",(a==null?void 0:a.name)??a," ",e.jsx("br",{}),e.jsx("span",{className:"text-muted-foreground",children:a==null?void 0:a.description})]},(a==null?void 0:a._id)||a))})]})},Le=()=>{var a,h;const[s,n]=l.useState("display"),[r,t]=l.useState(null),o=()=>{n(s==="display"?"form":"display")},c=ye();return e.jsxs(se,{"x-chunk":"dashboard-04-chunk-1",children:[e.jsxs(ae,{children:[e.jsx(ne,{children:"Security"}),e.jsx(te,{children:"Used to define your security and rules parameters of the store."})]}),e.jsx(re,{children:e.jsxs("div",{className:"border p-3 rounded-md bg-muted/40",children:[e.jsx("h4",{children:"Roles & Permissions"}),e.jsxs("p",{className:"text-muted-foreground text-sm",children:["Used to define your platform access permissions for each role."," "]}),s==="display"?e.jsxs(e.Fragment,{children:[e.jsxs(g,{size:"sm",onClick:o,className:"my-3",children:[e.jsx(me,{className:"h-4 w-4"}),e.jsx("span",{className:"ml-1",children:"Create Role"})]}),e.jsx("div",{className:"space-y-2",children:(h=(a=c.data)==null?void 0:a.roles)==null?void 0:h.map(u=>e.jsx(Ae,{role:u,setSelectedRole:t},u._id))})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"my-3",children:e.jsx(pe,{onClick:o})}),e.jsx(Ee,{selectedRole:r})]})]})})]})};export{Le as default};
