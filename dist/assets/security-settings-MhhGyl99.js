import{c as O,g as T,A as k,ap as z,r,$ as P,_,aq as L,ar as V,as as U,at as G,R as Z,j as e}from"./index-3nPIAQnH.js";import{u as I,a as F}from"./api-clients-BUUlQTs0.js";import{C as H,a as Y,b as J,c as W,d as X}from"./card-BJonHnI2.js";import{$ as ee,a as se}from"./check-BMG6f9gN.js";import{B as j}from"./button-CtZ5qbJi.js";import{z as y,u as ne,t as te,F as ae,a as v,b as w,c as N,d as R,e as E,f as re}from"./index-CWNnVEfM.js";import{u as B}from"./useMutation-D9iDBiiT.js";import{I as oe}from"./input-CN_5s6Mi.js";import{T as ie}from"./textarea-DKckVzxn.js";import{C as ce}from"./checkbox-DsnWyP3S.js";import{B as le}from"./back-button-CVlxe_DT.js";import{S as de}from"./square-plus-BeK5nUPZ.js";import{T as pe}from"./trash-2-BXYDxCkD.js";import"./label-3kCfBlTx.js";/**
 * @license lucide-react v0.378.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ue=O("ArrowUpDown",[["path",{d:"m21 16-4 4-4-4",key:"f6ql7i"}],["path",{d:"M17 20V4",key:"1ejh1v"}],["path",{d:"m3 8 4-4 4 4",key:"11wl7u"}],["path",{d:"M7 4v16",key:"1glfcx"}]]);/**
 * @license lucide-react v0.378.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const me=O("Cog",[["path",{d:"M12 20a8 8 0 1 0 0-16 8 8 0 0 0 0 16Z",key:"sobvz5"}],["path",{d:"M12 14a2 2 0 1 0 0-4 2 2 0 0 0 0 4Z",key:"11i496"}],["path",{d:"M12 2v2",key:"tus03m"}],["path",{d:"M12 22v-2",key:"1osdcq"}],["path",{d:"m17 20.66-1-1.73",key:"eq3orb"}],["path",{d:"M11 10.27 7 3.34",key:"16pf9h"}],["path",{d:"m20.66 17-1.73-1",key:"sg0v6f"}],["path",{d:"m3.34 7 1.73 1",key:"1ulond"}],["path",{d:"M14 12h8",key:"4f43i9"}],["path",{d:"M2 12h2",key:"1t8f8n"}],["path",{d:"m20.66 7-1.73 1",key:"1ow05n"}],["path",{d:"m3.34 17 1.73-1",key:"nuk764"}],["path",{d:"m17 3.34-1 1.73",key:"2wel8s"}],["path",{d:"m11 13.73-4 6.93",key:"794ttg"}]]),fe=async()=>(await F.get("/roles?expanded=true")).data;function he(){return I({queryKey:x.all,queryFn:fe})}const xe=async s=>await F.put(`/roles/${s._id}`,s);function ye(){const s=T();return B({mutationFn:xe,onMutate:async()=>{await s.cancelQueries({queryKey:x.all})},onSuccess:()=>{k.success("Role updated successfully")},onError:t=>{var o,a;k.error(((a=(o=t==null?void 0:t.response)==null?void 0:o.data)==null?void 0:a.message)||"An error occurred. Please try again.")},onSettled:()=>{s.invalidateQueries({queryKey:x.all})}})}const x={all:["roles"],details:()=>[...x.all,"detail"],detail:s=>[...x.details(),s],pagination:s=>[...x.all,"pagination",s],infinite:()=>[...x.all,"infinite"]},be=async s=>await F.post("/roles",s);function je(){const s=T();return B({mutationFn:be,onSuccess:()=>{s.invalidateQueries({queryKey:x.all}),k.success("Role created successfully")},onError:t=>{var o,a;k.error(((a=(o=t==null?void 0:t.response)==null?void 0:o.data)==null?void 0:a.message)||"An error occurred. Please try again.")}})}const $e=async()=>(await F.get("/permissions")).data;function ge(){return I({queryKey:b.all,queryFn:$e})}const b={all:["permissions"],details:()=>[...b.all,"detail"],detail:s=>[...b.details(),s],pagination:s=>[...b.all,"pagination",s],infinite:()=>[...b.all,"infinite"]},K="Collapsible",[Ce,Ye]=z(K),[ve,M]=Ce(K),we=r.forwardRef((s,t)=>{const{__scopeCollapsible:o,open:a,defaultOpen:i,disabled:l,onOpenChange:n,...f}=s,[p=!1,c]=ee({prop:a,defaultProp:i,onChange:n});return r.createElement(ve,{scope:o,disabled:l,contentId:se(),open:p,onOpenToggle:r.useCallback(()=>c(u=>!u),[c])},r.createElement(P.div,_({"data-state":q(p),"data-disabled":l?"":void 0},f,{ref:t})))}),Ne="CollapsibleTrigger",ke=r.forwardRef((s,t)=>{const{__scopeCollapsible:o,...a}=s,i=M(Ne,o);return r.createElement(P.button,_({type:"button","aria-controls":i.contentId,"aria-expanded":i.open||!1,"data-state":q(i.open),"data-disabled":i.disabled?"":void 0,disabled:i.disabled},a,{ref:t,onClick:L(s.onClick,i.onOpenToggle)}))}),Q="CollapsibleContent",_e=r.forwardRef((s,t)=>{const{forceMount:o,...a}=s,i=M(Q,s.__scopeCollapsible);return r.createElement(V,{present:o||i.open},({present:l})=>r.createElement(Fe,_({},a,{ref:t,present:l})))}),Fe=r.forwardRef((s,t)=>{const{__scopeCollapsible:o,present:a,children:i,...l}=s,n=M(Q,o),[f,p]=r.useState(a),c=r.useRef(null),u=U(t,c),d=r.useRef(0),h=d.current,$=r.useRef(0),g=$.current,S=n.open||f,A=r.useRef(S),C=r.useRef();return r.useEffect(()=>{const m=requestAnimationFrame(()=>A.current=!1);return()=>cancelAnimationFrame(m)},[]),G(()=>{const m=c.current;if(m){C.current=C.current||{transitionDuration:m.style.transitionDuration,animationName:m.style.animationName},m.style.transitionDuration="0s",m.style.animationName="none";const D=m.getBoundingClientRect();d.current=D.height,$.current=D.width,A.current||(m.style.transitionDuration=C.current.transitionDuration,m.style.animationName=C.current.animationName),p(a)}},[n.open,a]),r.createElement(P.div,_({"data-state":q(n.open),"data-disabled":n.disabled?"":void 0,id:n.contentId,hidden:!S},l,{ref:u,style:{"--radix-collapsible-content-height":h?`${h}px`:void 0,"--radix-collapsible-content-width":g?`${g}px`:void 0,...s.style}}),S&&i)});function q(s){return s?"open":"closed"}const Se=we,Re=Se,Ee=ke,Pe=_e,Me=y.object({name:y.string().nonempty("Name is required."),description:y.string().nonempty("Description is required."),permissions:y.array(y.string()).refine(s=>s.some(t=>t),{message:"You have to select at least one permission."})}),qe=({selectedRole:s})=>{var p;const t=ge(),o=ye(),a=je(),[i,l]=Z.useState({name:(s==null?void 0:s.name)||"",description:(s==null?void 0:s.description)||"",permissions:((p=s==null?void 0:s.permissions)==null?void 0:p.map(c=>(c==null?void 0:c._id)??c))||[]}),n=ne({resolver:te(Me),defaultValues:i,mode:"onChange"});async function f(c){let u;s?(await o.mutateAsync({...c,_id:s._id}),u=o.status):(await a.mutateAsync(c),u=a.status),u==="success"&&(l(void 0),n.reset())}return e.jsx(ae,{...n,children:e.jsxs("form",{onSubmit:n.handleSubmit(f),className:"space-y-4",children:[e.jsx(v,{control:n.control,name:"name",render:({field:c})=>e.jsxs(w,{children:[e.jsx(N,{children:"Name"}),e.jsx(R,{children:e.jsx(oe,{...c,placeholder:"Permission Name"})}),e.jsx(E,{})]})}),e.jsx(v,{control:n.control,name:"description",render:({field:c})=>e.jsxs(w,{children:[e.jsx(N,{children:"Description"}),e.jsx(R,{children:e.jsx(ie,{...c,placeholder:"Description"})}),e.jsx(E,{})]})}),e.jsx(v,{control:n.control,name:"permissions",render:()=>{var c,u;return e.jsxs(w,{children:[e.jsx(N,{children:"Permissions"}),e.jsx(E,{}),e.jsx("div",{className:"flex flex-wrap",children:(u=(c=t.data)==null?void 0:c.permissions)==null?void 0:u.map(d=>e.jsx("div",{className:"w-full md:w-1/2 p-1",children:e.jsx(v,{control:n.control,name:"permissions",render:({field:h})=>e.jsxs(w,{className:"flex flex-row items-start space-x-3 space-y-0 bg-white/40 dark:bg-black/40  rounded-md border p-4 shadow",children:[e.jsx(R,{children:e.jsx(ce,{checked:h.value.includes(d._id),onCheckedChange:$=>$?h.onChange([...h.value,d._id]):h.onChange(h.value.filter(g=>g!==d._id))})}),e.jsxs("div",{className:"space-y-1 leading-none",children:[e.jsx(N,{children:d.name}),e.jsx(re,{children:d==null?void 0:d.description})]})]},d._id)})},d._id))})]})}}),e.jsx("div",{className:"p-1",children:e.jsx(j,{type:"submit",children:"Submit"})})]})})},Ae=({role:s,setSelectedRole:t})=>{var i,l;const[o,a]=r.useState(!1);return e.jsxs(Re,{open:o,onOpenChange:a,children:[e.jsxs("div",{className:"flex flex-col items-start lg:items-center md:items-center lg:flex-row md:flex-row justify-between  px-4",children:[e.jsxs("h4",{className:"text-sm font-semibold",children:["@",s.name," (",(i=s==null?void 0:s.permissions)==null?void 0:i.length," permissions)"]}),e.jsxs("div",{children:[e.jsxs(j,{variant:"ghost",size:"sm",children:[e.jsx(pe,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"Delete"})]}),e.jsxs(j,{variant:"ghost",size:"sm",onClick:()=>t(s),children:[e.jsx(me,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"Edit"})]}),e.jsx(Ee,{asChild:!0,children:e.jsxs(j,{variant:"ghost",size:"sm",children:[e.jsx(ue,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"Toggle"})]})})]})]}),e.jsx("div",{className:"rounded-md border px-4 mb-2 py-2 font-mono text-sm shadow-sm",children:s.description}),e.jsx(Pe,{className:"space-y-2",children:(l=s.permissions)==null?void 0:l.map(n=>e.jsxs("div",{className:"rounded-md border px-4 py-2 font-mono text-sm shadow-sm",children:["@",(n==null?void 0:n.name)??n," ",e.jsx("br",{}),e.jsx("span",{className:"text-muted-foreground",children:n==null?void 0:n.description})]},(n==null?void 0:n._id)||n))})]})},Je=()=>{var n,f;const[s,t]=r.useState("display"),[o,a]=r.useState(null),i=()=>{t(s==="display"?"form":"display")},l=he();return e.jsxs(H,{"x-chunk":"dashboard-04-chunk-1",children:[e.jsxs(Y,{children:[e.jsx(J,{children:"Security"}),e.jsx(W,{children:"Used to define your security and rules parameters of the store."})]}),e.jsx(X,{children:e.jsxs("div",{className:"border p-3 rounded-md bg-muted/40",children:[e.jsx("h4",{children:"Roles & Permissions"}),e.jsxs("p",{className:"text-muted-foreground text-sm",children:["Used to define your platform access permissions for each role."," "]}),s==="display"?e.jsxs(e.Fragment,{children:[e.jsxs(j,{size:"sm",onClick:i,className:"my-3",children:[e.jsx(de,{className:"h-4 w-4"}),e.jsx("span",{className:"ml-1",children:"Create Role"})]}),e.jsx("div",{className:"space-y-2",children:(f=(n=l.data)==null?void 0:n.roles)==null?void 0:f.map(p=>e.jsx(Ae,{role:p,setSelectedRole:a},p._id))})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"my-3",children:e.jsx(le,{onClick:i})}),e.jsx(qe,{selectedRole:o})]})]})})]})};export{Je as default};
