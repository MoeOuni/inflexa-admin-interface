import{g as K,A as w,ap as se,au as X,r as c,ar as ae,_ as F,aq as v,as as oe,av as re,aw as ce,ax as ie,ay as le,$ as de,j as e,a as ue,d as V,R as I}from"./index-3nPIAQnH.js";import{E as me,u as fe,C as pe,T as ge,a as xe,b as H,c as he,f as U,d as be,e as Y,g as Ce,h as ye,i as $e,j as je}from"./table-D1Irnn66.js";import{B as C}from"./button-CtZ5qbJi.js";import{D as W,a as G,b as J,d as ve,e as we,f as _e}from"./dropdown-menu-DlVyJQqp.js";import{d as Se}from"./dayjs.min-DLk4Du8q.js";import{I as S}from"./input-CN_5s6Mi.js";import{$ as Ne}from"./check-BMG6f9gN.js";import{C as Pe}from"./confirm-button-CIa5yO4j.js";import{u as z}from"./useMutation-D9iDBiiT.js";import{u as Re,a as O}from"./api-clients-BUUlQTs0.js";import{z as j,u as Ee,t as Te,g as De,F as Fe,a as P,b as R,c as E,d as T,e as D}from"./index-CWNnVEfM.js";import{T as Me}from"./trash-2-BXYDxCkD.js";import{C as Oe,a as ke,b as He,c as Ae,d as Ie}from"./card-BJonHnI2.js";import{B as qe}from"./back-button-CVlxe_DT.js";import{S as Ke}from"./square-plus-BeK5nUPZ.js";import"./index-_x51y03b.js";import"./Combination-CsG-0PjX.js";import"./popover-BxiKflDC.js";import"./label-3kCfBlTx.js";const Ve=async()=>(await O.get("/categories")).data;function ze(){return Re({queryKey:y.all,queryFn:Ve})}function Le(){const n=K();return z({mutationFn:async t=>await O.put(`/categories/${t._id}`,t),onMutate:async()=>{await n.cancelQueries({queryKey:y.all})},onSuccess:()=>{w.success("Category updated successfully")},onError:t=>{var o,i;w.error(((i=(o=t==null?void 0:t.response)==null?void 0:o.data)==null?void 0:i.message)||"An error occurred. Please try again.")},onSettled:()=>{n.invalidateQueries({queryKey:y.all})}})}const Be=async n=>await O.post("/categories",n);function Qe(){const n=K();return z({mutationFn:Be,onSuccess:()=>{n.invalidateQueries({queryKey:y.all}),w.success("Category created successfully")},onError:s=>{var t,o;w.error(((o=(t=s==null?void 0:s.response)==null?void 0:t.data)==null?void 0:o.message)||"An error occurred. Please try again.")}})}const y={all:["categories"],details:()=>[...y.all,"detail"],detail:n=>[...y.details(),n],pagination:n=>[...y.all,"pagination",n],infinite:()=>[...y.all,"infinite"]};function Ue(){const n=K();return z({mutationFn:async t=>await O.delete(`/categories/${t}`),onSuccess:()=>{n.invalidateQueries({queryKey:y.all}),w.success("Category deleted successfully")},onMutate:async()=>{await n.cancelQueries({queryKey:y.all})},onError:t=>{var o,i;w.error(((i=(o=t==null?void 0:t.response)==null?void 0:o.data)==null?void 0:i.message)||"An error occurred. Please try again.")},onSettled:()=>{n.invalidateQueries({queryKey:y.all})}})}let A;const Z="HoverCard",[ee,Et]=se(Z,[X]),L=X(),[Ye,B]=ee(Z),We=n=>{const{__scopeHoverCard:s,children:t,open:o,defaultOpen:i,onOpenChange:d,openDelay:l=700,closeDelay:x=300}=n,u=L(s),h=c.useRef(0),b=c.useRef(0),f=c.useRef(!1),m=c.useRef(!1),[g=!1,a]=Ne({prop:o,defaultProp:i,onChange:d}),$=c.useCallback(()=>{clearTimeout(b.current),h.current=window.setTimeout(()=>a(!0),l)},[l,a]),_=c.useCallback(()=>{clearTimeout(h.current),!f.current&&!m.current&&(b.current=window.setTimeout(()=>a(!1),x))},[x,a]),r=c.useCallback(()=>a(!1),[a]);return c.useEffect(()=>()=>{clearTimeout(h.current),clearTimeout(b.current)},[]),c.createElement(Ye,{scope:s,open:g,onOpenChange:a,onOpen:$,onClose:_,onDismiss:r,hasSelectionRef:f,isPointerDownOnContentRef:m},c.createElement(ie,u,t))},Ge="HoverCardTrigger",Je=c.forwardRef((n,s)=>{const{__scopeHoverCard:t,...o}=n,i=B(Ge,t),d=L(t);return c.createElement(le,F({asChild:!0},d),c.createElement(de.a,F({"data-state":i.open?"open":"closed"},o,{ref:s,onPointerEnter:v(n.onPointerEnter,M(i.onOpen)),onPointerLeave:v(n.onPointerLeave,M(i.onClose)),onFocus:v(n.onFocus,i.onOpen),onBlur:v(n.onBlur,i.onClose),onTouchStart:v(n.onTouchStart,l=>l.preventDefault())})))}),Xe="HoverCardPortal",[Tt,Ze]=ee(Xe,{forceMount:void 0}),q="HoverCardContent",et=c.forwardRef((n,s)=>{const t=Ze(q,n.__scopeHoverCard),{forceMount:o=t.forceMount,...i}=n,d=B(q,n.__scopeHoverCard);return c.createElement(ae,{present:o||d.open},c.createElement(tt,F({"data-state":d.open?"open":"closed"},i,{onPointerEnter:v(n.onPointerEnter,M(d.onOpen)),onPointerLeave:v(n.onPointerLeave,M(d.onClose)),ref:s})))}),tt=c.forwardRef((n,s)=>{const{__scopeHoverCard:t,onEscapeKeyDown:o,onPointerDownOutside:i,onFocusOutside:d,onInteractOutside:l,...x}=n,u=B(q,t),h=L(t),b=c.useRef(null),f=oe(s,b),[m,g]=c.useState(!1);return c.useEffect(()=>{if(m){const a=document.body;return A=a.style.userSelect||a.style.webkitUserSelect,a.style.userSelect="none",a.style.webkitUserSelect="none",()=>{a.style.userSelect=A,a.style.webkitUserSelect=A}}},[m]),c.useEffect(()=>{if(b.current){const a=()=>{g(!1),u.isPointerDownOnContentRef.current=!1,setTimeout(()=>{var $;(($=document.getSelection())===null||$===void 0?void 0:$.toString())!==""&&(u.hasSelectionRef.current=!0)})};return document.addEventListener("pointerup",a),()=>{document.removeEventListener("pointerup",a),u.hasSelectionRef.current=!1,u.isPointerDownOnContentRef.current=!1}}},[u.isPointerDownOnContentRef,u.hasSelectionRef]),c.useEffect(()=>{b.current&&nt(b.current).forEach($=>$.setAttribute("tabindex","-1"))}),c.createElement(re,{asChild:!0,disableOutsidePointerEvents:!1,onInteractOutside:l,onEscapeKeyDown:o,onPointerDownOutside:i,onFocusOutside:v(d,a=>{a.preventDefault()}),onDismiss:u.onDismiss},c.createElement(ce,F({},h,x,{onPointerDown:v(x.onPointerDown,a=>{a.currentTarget.contains(a.target)&&g(!0),u.hasSelectionRef.current=!1,u.isPointerDownOnContentRef.current=!0}),ref:f,style:{...x.style,userSelect:m?"text":void 0,WebkitUserSelect:m?"text":void 0,"--radix-hover-card-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-hover-card-content-available-width":"var(--radix-popper-available-width)","--radix-hover-card-content-available-height":"var(--radix-popper-available-height)","--radix-hover-card-trigger-width":"var(--radix-popper-anchor-width)","--radix-hover-card-trigger-height":"var(--radix-popper-anchor-height)"}})))});function M(n){return s=>s.pointerType==="touch"?void 0:n()}function nt(n){const s=[],t=document.createTreeWalker(n,NodeFilter.SHOW_ELEMENT,{acceptNode:o=>o.tabIndex>=0?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP});for(;t.nextNode();)s.push(t.currentNode);return s}const st=We,at=Je,te=et,ot=st,rt=at,ne=c.forwardRef(({className:n,align:s="center",sideOffset:t=4,...o},i)=>e.jsx(te,{ref:i,align:s,sideOffset:t,className:ue("z-50 w-64 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",n),...o}));ne.displayName=te.displayName;function ct({data:n,handleEdit:s}){var $,_;const{t}=V(),o=Ue(),[i,d]=c.useState([]),[l,x]=c.useState([]),[u,h]=c.useState({}),[b,f]=c.useState({}),m=async r=>{await o.mutateAsync(r)},g=[{accessorKey:"name",header:t("category_name_label"),cell:({row:r})=>e.jsx("div",{className:"capitalize",children:r.getValue("name")})},{accessorKey:"createdAt",header:t("category_created_at_label"),cell:({row:r})=>e.jsx("div",{className:"lowercase",children:Se(r.getValue("createdAt")).format("DD/MM/YYYY")})},{accessorKey:"subCategory",header:t("category_sub_category_key"),cell:({row:r})=>{var N,Q;const p=(N=r.original.subCategories)==null?void 0:N.length;return e.jsxs(ot,{children:[e.jsx(rt,{asChild:!0,children:e.jsxs(C,{variant:"link",className:"font-medium",children:[p," ",t("category_sub_category_mini_unit")]})}),e.jsx(ne,{className:"w-80",children:e.jsx("ul",{className:"my-2 ml-5 list-disc [&>li]:mt-2",children:(Q=r.original.subCategories)==null?void 0:Q.map(k=>e.jsxs("li",{children:[e.jsx("div",{className:"capitalize",children:k.name}),e.jsx("div",{className:"text-sm text-muted-foreground",children:k.description})]},k._id))})})]})}},{id:"actions",enableHiding:!1,cell:({row:r})=>e.jsxs(W,{children:[e.jsx(G,{asChild:!0,children:e.jsxs(C,{variant:"ghost",className:"h-8 w-8 p-0",children:[e.jsx("span",{className:"sr-only",children:t("open_menu")}),e.jsx(me,{className:"h-4 w-4"})]})}),e.jsxs(J,{align:"end",children:[e.jsx(ve,{children:t("actions")}),e.jsx(C,{size:"sm",variant:"ghost",className:"w-full flex justify-start",onClick:()=>{s(r.original)},children:t("category_edit_button")}),e.jsx(we,{}),e.jsx(Pe,{confirmFunction:()=>m(String(r.original._id)),confirmTitle:t("category_delete_confirm_title"),confirmText:t("category_delete_confirm_text"),children:e.jsx(C,{size:"sm",variant:"ghost",className:"w-full flex justify-start",children:t("category_delete_button")})})]})]})}],a=fe({data:n,columns:g,onSortingChange:d,onColumnFiltersChange:x,getCoreRowModel:Ce(),getPaginationRowModel:ye(),getSortedRowModel:$e(),getFilteredRowModel:je(),onColumnVisibilityChange:h,onRowSelectionChange:f,initialState:{pagination:{pageIndex:0,pageSize:6}},state:{sorting:i,columnFilters:l,columnVisibility:u,rowSelection:b}});return e.jsxs("div",{className:"w-full",children:[e.jsxs("div",{className:"flex items-center py-4",children:[e.jsx(S,{placeholder:t("search_category"),value:(($=a.getColumn("name"))==null?void 0:$.getFilterValue())??"",onChange:r=>{var p;return(p=a.getColumn("name"))==null?void 0:p.setFilterValue(r.target.value)},className:"max-w-sm"}),e.jsxs(W,{children:[e.jsx(G,{asChild:!0,children:e.jsxs(C,{variant:"outline",className:"ml-auto",children:[t("columns")," ",e.jsx(pe,{className:"ml-2 h-4 w-4"})]})}),e.jsx(J,{align:"end",children:a.getAllColumns().filter(r=>r.getCanHide()).map(r=>{var p;return e.jsx(_e,{className:"capitalize",checked:r.getIsVisible(),onCheckedChange:N=>r.toggleVisibility(!!N),children:String((p=r.columnDef)==null?void 0:p.header)},r.id)})})]})]}),e.jsx("div",{className:"rounded-md border",children:e.jsxs(ge,{children:[e.jsx(xe,{children:a.getHeaderGroups().map(r=>e.jsx(H,{children:r.headers.map(p=>e.jsx(he,{children:p.isPlaceholder?null:U(p.column.columnDef.header,p.getContext())},p.id))},r.id))}),e.jsx(be,{children:(_=a.getRowModel().rows)!=null&&_.length?a.getRowModel().rows.map(r=>e.jsx(H,{"data-state":r.getIsSelected()&&"selected",children:r.getVisibleCells().map(p=>e.jsx(Y,{children:U(p.column.columnDef.cell,p.getContext())},p.id))},r.id)):e.jsx(H,{children:e.jsx(Y,{colSpan:g==null?void 0:g.length,className:"h-24 text-center",children:"No results."})})})]})}),e.jsx("div",{className:"flex items-center justify-end space-x-2 py-4",children:e.jsxs("div",{className:"space-x-2",children:[e.jsx(C,{variant:"outline",size:"sm",onClick:()=>a.previousPage(),disabled:!a.getCanPreviousPage(),children:t("previous")}),e.jsx(C,{variant:"outline",size:"sm",onClick:()=>a.nextPage(),disabled:!a.getCanNextPage(),children:t("next")})]})})]})}function it({children:n}){return e.jsx("small",{className:"text-sm font-medium leading-none dark:text-white text-black",children:n})}const lt=j.object({name:j.string().min(2,{message:"Name is required"}),description:j.string().optional(),image:j.string().optional(),subCategories:j.array(j.object({name:j.string().nonempty("Name is required"),description:j.string().optional(),image:j.string().optional()})).optional()});function dt({selectedCategory:n}){const{t:s}=V(),t=Qe(),o=Le(),[i,d]=I.useState(n||void 0),l=Ee({resolver:Te(lt),defaultValues:i,mode:"onChange"}),{fields:x,append:u,remove:h}=De({name:"subCategories",control:l.control});async function b(f){d(f);let m;n?(o.mutate({...f,_id:n==null?void 0:n._id}),m=o.status):(t.mutate(f),m=t.status),m==="success"&&(d(void 0),x.forEach((g,a)=>h(a)),l.reset())}return e.jsx("div",{className:"py-4",children:e.jsx(Fe,{...l,children:e.jsxs("form",{onSubmit:l.handleSubmit(b),className:"space-y-4",children:[e.jsx(P,{control:l.control,name:"name",render:({field:f})=>e.jsxs(R,{children:[e.jsx(E,{children:s("category_name_label")}),e.jsx(T,{children:e.jsx(S,{...f,disabled:t.isPending})}),e.jsx(D,{})]})}),e.jsx(P,{control:l.control,name:"description",render:({field:f})=>e.jsxs(R,{children:[e.jsx(E,{children:s("category_description_label")}),e.jsx(T,{children:e.jsx(S,{...f,disabled:t.isPending})}),e.jsx(D,{})]})}),e.jsxs("div",{className:"p-3 border rounded-md bg-muted/40 space-y-6",children:[e.jsx("div",{children:e.jsx(it,{children:s("category_sub_category_key")})}),x.map((f,m)=>e.jsxs("div",{className:"flex gap-2",children:[e.jsx(P,{control:l.control,name:`subCategories.${m}.name`,render:({field:g})=>e.jsxs(R,{className:"w-[40%]",children:[e.jsx(E,{children:s("category_name_label")}),e.jsx(T,{children:e.jsx(S,{...g,disabled:t.isPending})}),e.jsx(D,{})]})}),e.jsx(P,{control:l.control,name:`subCategories.${m}.description`,render:({field:g})=>e.jsxs(R,{className:"w-[50%]",children:[e.jsx(E,{children:s("category_description_label")}),e.jsx(T,{children:e.jsx(S,{...g,disabled:t.isPending})}),e.jsx(D,{})]})}),e.jsx(C,{variant:"outline",onClick:()=>h(m),className:"mt-8",disabled:t.isPending,children:e.jsx(Me,{})})]},f.id)),e.jsx(C,{type:"button",variant:"outline",size:"sm",className:"mt-2",disabled:t.isPending,onClick:()=>u({name:"",description:"",image:""}),children:s("category_sub_category_add_button")})]}),e.jsx(C,{type:"submit",disabled:t.isPending,children:s("submit")})]})})})}const Dt=()=>{var u;const{t:n}=V(),s=ze(),[t,o]=I.useState("table"),[i,d]=I.useState(null),l=()=>{o(t==="table"?"form":"table")},x=h=>{d(h||null),h&&o("form")};return e.jsx(e.Fragment,{children:e.jsxs(Oe,{"x-chunk":"dashboard-04-chunk-1",children:[e.jsxs(ke,{children:[e.jsx(He,{children:n("categories")}),e.jsx(Ae,{children:n("categories_table_description")})]}),e.jsxs(Ie,{children:[t==="table"?e.jsxs(C,{size:"sm",className:"flex gap-1 items-center",onClick:l,children:[e.jsx(Ke,{className:"h-4 w-4"})," ",n("category_add_button")]}):e.jsx(qe,{onClick:l}),t==="table"?e.jsx(ct,{data:((u=s==null?void 0:s.data)==null?void 0:u.categories)??[],handleEdit:x}):e.jsx(dt,{selectedCategory:i,setSelectedCategory:d})]})]})})};export{Dt as default};
