import{J as P,K as F,M as j,e as S,N as I,j as e,C as D,a as _,b as A,c as L,P as k,Q as q,R as E,G as Q,z as R,B as v,I as h,m as K,g as z,S as U,T as C,u as V,U as T,V as G,L as W}from"./index-Cpj_313k.js";import{u as $,F as H,a as g,b as f,c as y,d as w,e as N,t as J}from"./index-Bir7vsR2.js";import{S as O}from"./separator-CbIO-aeg.js";import{P as X}from"./store-Bt4IQKUI.js";import{p as b}from"./purchase-query-keys-BZk4QrP-.js";import{p as Y}from"./product-query-keys-IYfJB1mD.js";import{B}from"./back-button-D-5gooSg.js";import{S as Z,C as ee}from"./save-BqmzOMAP.js";import{u as se}from"./use-supplier-BIoiUAGX.js";import{C as ae,a as te,b as ne,c as re,d as ie,e as le,f as oe,g as ce}from"./command-BLH0lZHp.js";import{P as de,a as me,b as xe}from"./popover-DROVBhEs.js";import"./supplier-query-keys-DIv9u3_S.js";const ue=async s=>await S.post("/purchases",s);function je(){const s=P();return F({mutationFn:ue,onSuccess:()=>{s.invalidateQueries({queryKey:b.all}),j.success("Purchase created successfully.")},onError:a=>{var r,t;j.error(((t=(r=a==null?void 0:a.response)==null?void 0:r.data)==null?void 0:t.message)||"An error occurred. Please try again.")}})}function he(){const s=P();return F({mutationFn:async r=>await S.patch(`/purchases/${r==null?void 0:r._id}`,r),onMutate:async()=>{await s.cancelQueries({queryKey:b.all})},onSuccess:()=>{s.invalidateQueries({queryKey:b.all}),j.success("Purchase updated successfully.")},onError:r=>{var t,o;j.error(((o=(t=r==null?void 0:r.response)==null?void 0:t.data)==null?void 0:o.message)||"An error occurred. Please try again.")},onSettled:()=>{s.invalidateQueries({queryKey:b.all})}})}const pe=async s=>await S.post("/products/init",s);function ge(){const s=P();return F({mutationFn:pe,onSuccess:()=>{s.invalidateQueries({queryKey:Y.all}),j.success("Inventory created successfully.")},onError:a=>{var r,t;j.error(((t=(r=a==null?void 0:a.response)==null?void 0:r.data)==null?void 0:t.message)||"An error occurred. Please try again.")}})}/**
 * @license lucide-react v0.441.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const fe=I("ArrowRight",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]]);/**
 * @license lucide-react v0.441.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ye=I("Tags",[["path",{d:"m15 5 6.3 6.3a2.4 2.4 0 0 1 0 3.4L17 19",key:"1cbfv1"}],["path",{d:"M9.586 5.586A2 2 0 0 0 8.172 5H3a1 1 0 0 0-1 1v5.172a2 2 0 0 0 .586 1.414L8.29 18.29a2.426 2.426 0 0 0 3.42 0l3.58-3.58a2.426 2.426 0 0 0 0-3.42z",key:"135mg7"}],["circle",{cx:"6.5",cy:"9.5",r:".5",fill:"currentColor",key:"5pm5xn"}]]);function M({purchase:s,currency:a}){var r,t,o,d,c;return e.jsxs(D,{children:[e.jsx(_,{children:e.jsx(A,{children:"Purchase Details "})}),e.jsx(L,{children:e.jsxs("div",{className:"grid gap-4 text-sm",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Reference"}),e.jsx("span",{children:s==null?void 0:s.reference})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Supplier"}),e.jsx("span",{children:s==null?void 0:s.supplierLabel})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Date"}),e.jsx("span",{children:s.createdAt})]}),(r=s==null?void 0:s.purchaseDetails)!=null&&r.length?e.jsxs(e.Fragment,{children:[e.jsx("ul",{className:"grid gap-3 ",children:(t=s.purchaseDetails)==null?void 0:t.map((l,n)=>e.jsxs("li",{className:"flex items-center justify-between",children:[e.jsxs("span",{className:"text-muted-foreground",children:[l.name," x ",e.jsx("span",{children:l.quantity})]}),e.jsxs("span",{children:[(l.price*l.quantity).toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2})," ",a==null?void 0:a.symbol]})]},n))}),e.jsx(O,{className:"my-2"}),e.jsxs("ul",{className:"grid gap-3 ",children:[e.jsxs("li",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Total ET"}),e.jsxs("span",{children:[((o=k(s.purchaseDetails))==null?void 0:o.toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2}))??0," ",a==null?void 0:a.symbol]})]}),e.jsxs("li",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Total Taxes"}),e.jsxs("span",{children:[((d=q(s.purchaseDetails))==null?void 0:d.toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2}))??0," ",a==null?void 0:a.symbol]})]}),e.jsxs("li",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Total Price"}),e.jsxs("span",{children:[((c=E(s.purchaseDetails))==null?void 0:c.toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2}))??0," ",a==null?void 0:a.symbol]})]})]})]}):e.jsx(e.Fragment,{})]})})]})}function Ne({purchase:s,setPurchase:a,setSteps:r}){const t=ge(),o=he(),d=Q(),{tax:c,currency:l}=R(),n=$({resolver:J(X),defaultValues:{reference:"",name:"",price:0,tax:c,quantity:1,unit:""},mode:"onChange"}),m=async()=>{const i={_id:s._id,reference:s.reference,supplier:s.supplierId,totalPrice:E(s.purchaseDetails)??0,totalWithoutTax:k(s.purchaseDetails)??0,totalTax:q(s.purchaseDetails)??0,broughtAt:K(s.createdAt).toDate()};await o.mutateAsync(i),a({reference:"",supplierId:"",supplierLabel:"",createdAt:"",purchaseDetails:[],total:0}),r(0)},p=async i=>{try{if(!(s!=null&&s._id))return j.error("Purchase not created yet try again. or contact the support team.");const u={...i,purchaseId:s==null?void 0:s._id,purchaseReference:s==null?void 0:s.reference};await t.mutateAsync(u);const x=s.purchaseDetails||[];x.push(i),a({...s,purchaseDetails:x}),n.reset({reference:"",name:"",price:0,tax:c,quantity:1,unit:""})}catch{j.error("An error occurred while saving the product.")}};return e.jsx("div",{children:e.jsx(H,{...n,children:e.jsxs("form",{onSubmit:n.handleSubmit(p),children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(B,{onClick:()=>{d("/purchases")}}),e.jsx("h1",{className:"flex-1 shrink-0 whitespace-nowrap text-xl font-semibold tracking-tight sm:grow-0",children:"New Purchase"}),e.jsxs("div",{className:"hidden items-center gap-2 md:ml-auto md:flex",children:[e.jsxs(v,{type:"button",variant:"outline",size:"sm",className:"h-8 gap-1",onClick:m,children:[e.jsx(Z,{className:"h-3.5 w-3.5"}),e.jsx("span",{className:"sr-only sm:not-sr-only sm:whitespace-nowrap",children:"Save Purchase"})]}),e.jsxs(v,{type:"submit",size:"sm",className:"h-8 gap-1",children:[e.jsx(ye,{className:"h-3.5 w-3.5"}),e.jsx("span",{className:"sr-only sm:not-sr-only sm:whitespace-nowrap",children:"Save Product"})]})]})]}),e.jsxs("div",{className:"grid md:grid-cols-[350px_1fr] gap-4 mx-auto py-3 ",children:[e.jsx(M,{purchase:s,currency:l}),e.jsxs(D,{children:[e.jsx(_,{children:e.jsx(A,{children:"Product"})}),e.jsxs(L,{className:"grid gap-6",children:[e.jsxs("div",{className:"grid md:grid-cols-2 gap-4 ",children:[e.jsx("div",{className:"grid gap-4",children:e.jsx(g,{name:"name",control:n.control,render:({field:i})=>e.jsxs(f,{children:[e.jsx(y,{children:"Product Name"}),e.jsx(w,{children:e.jsx(h,{...i})}),e.jsx(N,{})]})})}),e.jsx("div",{className:"grid gap-4",children:e.jsx(g,{name:"reference",control:n.control,render:({field:i})=>e.jsxs(f,{children:[e.jsx(y,{children:"Reference"}),e.jsx(w,{children:e.jsx(h,{...i})}),e.jsx(N,{})]})})})]}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[e.jsx(g,{name:"price",control:n.control,render:({field:i})=>e.jsxs(f,{children:[e.jsxs(y,{children:["Price (",l==null?void 0:l.symbol,")"]}),e.jsx(h,{type:"number",step:"0.01",min:0,...i,onChange:u=>{const x=parseFloat(u.target.value);i.onChange(typeof x=="number"&&x)}}),e.jsx(N,{})]})}),e.jsx(g,{name:"tax",control:n.control,render:({field:i})=>e.jsxs(f,{children:[e.jsx(y,{children:"Tax"}),e.jsx(h,{type:"number",step:"0.01",min:0,...i,onChange:u=>{const x=parseFloat(u.target.value);i.onChange(typeof x=="number"&&x)}}),e.jsx(N,{})]})})]}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[e.jsx(g,{name:"unit",control:n.control,render:({field:i})=>e.jsxs(f,{children:[e.jsx(y,{children:"Unit"}),e.jsx(w,{children:e.jsx(h,{...i})}),e.jsx(N,{})]})}),e.jsx(g,{name:"quantity",control:n.control,render:({field:i})=>e.jsxs(f,{children:[e.jsx(y,{children:"Quantity"}),e.jsx(h,{type:"number",min:0,step:"0.01",...i,onChange:u=>{const x=parseFloat(u.target.value);i.onChange(typeof x=="number"&&x)}}),e.jsx(N,{})]})})]})]})]})]})]})})})}function ve({items:s,value:a,onChange:r,placeholder:t}){var c;const[o,d]=z.useState(!1);return e.jsxs(de,{open:o,onOpenChange:d,children:[e.jsx(me,{asChild:!0,children:e.jsxs(v,{variant:"outline",role:"combobox","aria-expanded":o,className:"w-full justify-between",children:[a?(c=s.find(l=>l.value===a))==null?void 0:c.label:`Select ${t}...`,e.jsx(ae,{className:"ml-2 h-4 w-4 shrink-0 opacity-50"})]})}),e.jsx(xe,{className:"p-0",children:e.jsxs(te,{className:"",children:[e.jsx(ne,{className:"",placeholder:`Search ${t}...`}),e.jsxs(re,{className:"",children:[e.jsxs(ie,{children:["No ",t," found."]}),e.jsx(le,{children:s.map(l=>e.jsxs(oe,{value:l.value,onSelect:n=>{var i;const m=n===a?"":n,p=n===a?"":(i=s.find(u=>u.value===m))==null?void 0:i.label;r(m,p),d(!1)},children:[e.jsx(ce,{className:U("mr-2 h-4 w-4",a===l.value?"opacity-100":"opacity-0")}),l.label]},l.value))})]})]})})]})}const be=({purchase:s,setPurchase:a})=>{var c,l;const{currency:r}=R(),t=se({status:"ACTIVE"}),o=(n,m)=>{a({...s,supplierId:n,supplierLabel:m})},d=n=>{a({...s,createdAt:n})};return e.jsxs("div",{className:"grid md:grid-cols-[350px_1fr] gap-4  mx-auto py-3",children:[e.jsx(M,{purchase:s,currency:r}),e.jsxs(D,{className:"w-full",children:[e.jsx(_,{children:e.jsx(A,{children:"General Informations (Required)"})}),e.jsxs(L,{className:"grid xlg:grid-cols-3 md:grid-cols-2 grid-cols-1 gap-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(C,{children:"Supplier"}),e.jsx(ve,{value:s==null?void 0:s.supplierId,onChange:o,placeholder:"supplier",items:(t==null?void 0:t.status)!=="success"?[]:(l=(c=t==null?void 0:t.data)==null?void 0:c.data)==null?void 0:l.map(n=>({label:n==null?void 0:n.companyName,value:n==null?void 0:n._id}))})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(C,{children:"Date"}),e.jsx(h,{id:"date",type:"date",value:s==null?void 0:s.createdAt,onChange:n=>d(n.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(C,{children:"Reference"}),e.jsx(h,{id:"reference",placeholder:"Enter reference",value:s.reference,onChange:n=>a({...s,reference:n.target.value})})]})]})]})]})},qe=()=>{const s=je(),{t:a}=V(),r=Q(),[t,o]=T("__purchase_form",{defaultValue:{_id:"",reference:"",supplierId:"",supplierLabel:"",createdAt:"",purchaseDetails:[],total:0}}),[d,c]=T("__supplier_form_step",{defaultValue:0}),{id:l}=G(),n=async()=>{if(t!=null&&t.supplierId){if(!(t!=null&&t.reference))return j.error(a("errors.error_required_reference"))}else return j.error(a("errors.error_required_id_supplier"));const m={reference:t.reference,supplier:t.supplierId,totalPrice:0,totalWithoutTax:0,totalTax:0,broughtAt:K(t.createdAt).toDate()};await s.mutateAsync(m),c(1)};return z.useEffect(()=>{var m,p,i;if(s.isSuccess)return o({...t,_id:(i=(p=(m=s==null?void 0:s.data)==null?void 0:m.data)==null?void 0:p.data)==null?void 0:i._id})},[s==null?void 0:s.isSuccess]),e.jsx(e.Fragment,{children:!l&&e.jsx("div",{children:d===0?e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(B,{onClick:()=>{r("/purchases")}}),e.jsx("h1",{className:"flex-1 shrink-0 whitespace-nowrap text-xl font-semibold tracking-tight sm:grow-0",children:"New Purchase"}),e.jsxs("div",{className:"hidden items-center gap-2 md:ml-auto md:flex",children:[e.jsxs(v,{type:"button",variant:"outline",size:"sm",className:"h-8 gap-1",onClick:()=>{r("/purchases")},children:[e.jsx(ee,{className:"h-3.5 w-3.5"}),e.jsx("span",{className:"sr-only sm:not-sr-only sm:whitespace-nowrap",children:"Discard"})]}),e.jsxs(v,{size:"sm",onClick:n,disabled:s.isPending,className:"h-8 gap-1",children:[s.isPending?e.jsx(W,{className:"h-3.5 w-3.5 animate-spin"}):e.jsx(fe,{className:"h-3.5 w-3.5"}),e.jsx("span",{className:"sr-only sm:not-sr-only sm:whitespace-nowrap",children:"Next"})]})]})]}),e.jsx(be,{purchase:t??{reference:"",supplierId:"",supplierLabel:"",createdAt:"",purchaseDetails:[],total:0,_id:""},setPurchase:o})]}):e.jsx(Ne,{purchase:t??{reference:"",supplierId:"",supplierLabel:"",createdAt:"",purchaseDetails:[],total:0,_id:""},setPurchase:o,setSteps:c})})})};export{qe as default};
